<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ClaimRight - Chat</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">


    <link rel="stylesheet" href="/Front_End/css/chat-page.css" />
    <link rel="stylesheet" href="/Front_End/css/navigation-bar.css">
    <link rel="stylesheet" href="/Front_End/css/page-styles.css">

    <link rel="icon" href="/Front_End/assets/images/Leonardo_Phoenix_09_Design_a_modern_clean_logo_for_a_Lost_and_0.jpg" type="image">

</head>
<body>
  <div id="navbar-container"></div> 

  <div class="chat-container">
    <button class="user-toggle-btn" onclick="toggleUserList()">☰ Chats</button>
    <!-- Left Side Users -->
    <div class="user-list">
      <h2>Chats</h2>
      <div class="user-search-wrapper position-relative mb-3 p-2">
        <input 
          type="text" 
          id="userSearchInput" 
          class="form-control pe-5" 
          placeholder="Search users ..." 
          oninput="filterUsers()"
        />
        <button 
          class="btn position-absolute top-50 end-0 translate-middle-y me-2 border-0 bg-transparent" 
          onclick="clearSearch()" 
          aria-label="Clear search"
        >
          ✖
        </button>
      </div>

      <div id="usersContainer">
        <!-- users will be rendered here dynamically -->
      </div>
    </div>



    <!-- Right Side Chat Window -->
    <div class="chat-box">
      <!-- add the selected users name in the header -->
      <div class="chat-header" id="chatHeader"></div> 
      <div class="chat-messages" id="chatMessages">
        <!-- <div class="message received">Hello, how can I help you?</div>
        <div class="message sent">Hi! I have a question regarding my claim.</div> -->
      </div>

      <div class="chat-input">
        <input type="file" id="fileInput" accept="image/*" onchange="handleFileUpload(event)" aria-label="Attach a file"/>
        <button type="button" class="file-btn" onclick="document.getElementById('fileInput').click()" aria-label="Attach a file"><i class="bi bi-file-image"></i></button>
        
        <div id="imagePreviewContainer" class="d-flex align-items-center mt-2 d-none">
          <img id="imagePreview" class="img-thumbnail me-2" style="max-height: 60px;" alt="Image preview" />
          <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeSelectedImage()" aria-label="Remove image">
            <i class="bi bi-x-circle"></i>
          </button>
        </div>

        
        <input type="text" id="messageInput" placeholder="Type a message..." />
        <button type="button" class="send-btn" onclick="sendMessageOrImage()">Send</button>
      </div>

    </div>
  </div>


  <!-- Image View Modal -->
  <div class="modal fade" id="chatImageViewModal" tabindex="-1" aria-labelledby="chatImageViewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content bg-dark text-white border-0">
        <div class="modal-body text-center p-0">
          <img id="chatModalImage" class="img-fluid rounded" alt="Preview"/>
        </div>
        <div class="modal-footer justify-content-center border-0">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Fix modal accessibility issue: move modal to end of body and set aria-hidden properly -->
  <!-- Your modals should not be within other containers or nested in hidden regions -->

  <!-- Image Send Preview Modal -->
  <div class="modal fade" id="imagePreviewModal" tabindex="-1" aria-labelledby="imagePreviewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content p-3">
        <div class="modal-header border-0">
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="clearSelectedImage()"></button>
        </div>



        <div class="modal-body text-center">
          <img id="modalImagePreview" src="" class="img-fluid rounded shadow-sm" alt="Preview" />
        </div>
        <div class="modal-footer border-0 justify-content-end">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="clearSelectedImage()">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="sendMessageOrImage()">Send Image</button>
        </div>
      </div>
    </div>
  </div>

    <!-- Login popup -->
    <div id="login-popup-container"></div>
    <!-- Edit profile popup -->
    <div id="edit-profile-container"></div>
    <div id="footer-container"></div>
    <div id="loading-animation"></div>

    <div id="chatSendingOverlay" style="display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); justify-content:center; align-items:center;">
      <div class="spinner-border text-light" role="status">
        <span class="visually-hidden">Sending...</span>
      </div>
    </div>

    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.6.1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>


    <script src="/Front_End/js/navigationBar.js"></script>
    <script src="/Front_End/js/loginSignup.js"></script>
    <script src="/Front_End/js/updateOwnProfile.js"></script>
    <script src="/Front_End/js/chatPageSecond.js"></script>

</body>
</html>
